---
import Layout from "../layouts/Layout.astro";
import CategoryArea from "../components/CategoryArea.astro";
import { tabInfos, type TabKeys } from "../components/Tabs.astro";
import { allCategories, type Category } from "../libs/prompts-store";
import OutputArea from "../components/OutputArea.astro";

const tabKey: TabKeys = `main`;
const tabName = tabInfos[tabKey].ja;
const layoutInfo = {
  tabKey,
  tabName,
};

const names: { [K in Category]: string } = {
  eyesColors: `目の色`,
  eyesShapes: `目の形状`,
  eyebrows: `眉毛`,
  eyelashes: `睫毛`,
  hairLengths: `髪の長さ`,
  hairStyles: `髪型`,
} as const;
---

<Layout {...layoutInfo}>
  <before-unload-script data-prod={import.meta.env.PROD} style="display:none"
  ></before-unload-script>
  {
    allCategories.map((category) => (
      <CategoryArea name={names[category]} key={category} />
    ))
  }
  <OutputArea />
</Layout>

<script>
  // Enable scripts only production mode.
  class BeforeUnloadScript extends HTMLElement {
    constructor() {
      super();

      const isProduction = this.dataset.prod === ``;
      if (isProduction) {
        window.addEventListener(`beforeunload`, (event: BeforeUnloadEvent) => {
          event.preventDefault();
          event.returnValue = ``;
        });
      }
    }
  }

  customElements.define(`before-unload-script`, BeforeUnloadScript);
</script>

---
import type { Prompt } from "../store";

interface Props {
  key: Prompt;
}

const { key } = Astro.props;
---

<prompt-button data-key={key}>
  {key}
</prompt-button>

<script>
  import { type Prompt, promptStates } from "../store";

  class PromptButton extends HTMLElement {
    constructor() {
      super();

      const key = this.dataset.key as Prompt;
      if (!key) return;

      this.addEventListener(`click`, () => {
        const p = promptStates.get();
        const filtered = p.filter(({ prompt }) => prompt === key);

        filtered[0].isEnable = !filtered[0].isEnable;
        promptStates.set([...p]);
      });

      promptStates.subscribe((p) => {
        const row = p.filter(({ prompt }) => prompt === key)[0];

        if (row.isEnable) {
          this.classList.add(`enable`);
        } else {
          this.classList.remove(`enable`);
        }
      });
    }
  }

  customElements.define(`prompt-button`, PromptButton);
</script>

<style>
  prompt-button {
    border: 1px solid rgb(var(--text-main));
    border-radius: 0.5rem;
    padding: 0.4rem;
    transition-duration: 200ms;
    cursor: pointer;
  }
  prompt-button:hover {
    background-color: rgb(var(--accent-dark));
    transition-duration: 200ms;
  }

  .enable {
    background: rgb(var(--accent));
    border-color: rgb(var(--accent-dark));
  }
</style>
